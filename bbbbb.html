<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DASHBOARD</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        /* ========================================================== */
        /* GLOBALE STILE UND RESPONSIVES DESIGN                      */
        /* ========================================================== */

        /* CSS-Variablen für die Designs */
        :root {
            /* Dunkler Modus (Standard) */
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            --text-color: #f0f0f0;
            --dark-bg: #1a1a2e;
            --glow-color: #ff9900;
            --accent-color: var(--glow-color);
            --color-ok: #39ff14;
            --color-warning: #ffcc00;
            --color-critical: #ff0055;
            --color-info: #0099ff;
        }

        /* Heller Modus */
        body.light-mode {
            --glass-bg: rgba(255, 255, 255, 0.5);
            --glass-border: rgba(255, 255, 255, 0.6);
            --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
            --text-color: #333;
            --dark-bg: #e0e0e0;
            --glow-color: #007bff;
            --accent-color: var(--glow-color);
            --color-ok: #28a745;
            --color-warning: #ffc107;
            --color-critical: #dc3545;
            --color-info: #17a2b8;
        }

        /* Grüner Akzent-Modus */
        body.green-accent-mode {
            --glow-color: #39ff14;
            --accent-color: var(--glow-color);
        }

        /* Blauer Neon-Modus */
        body.blue-neon-mode {
            --glass-bg: rgba(100, 150, 255, 0.1);
            --glass-border: rgba(100, 150, 255, 0.3);
            --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.4);
            --text-color: #e0f2ff;
            --dark-bg: #000033;
            --glow-color: #00ffff;
            --accent-color: var(--glow-color);
        }

        /* Solarized-Modus (Hell) */
        body.solarized-light-mode {
            --glass-bg: rgba(253, 246, 227, 0.5);
            --glass-border: rgba(253, 246, 227, 0.8);
            --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
            --text-color: #586e75;
            --dark-bg: #fdf6e3;
            --glow-color: #cb4b16;
            --accent-color: var(--glow-color);
        }

        /* Globale Stile für den Body */
        body {
            margin: 0;
            font-family: 'Poppins', sans-serif;
            background-color: var(--dark-bg);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
            transition: background-color 0.5s ease;
        }

        /* Überschrift, die sich automatisch an die Bildschirmbreite anpasst */
        .header {
            text-align: center;
            margin-bottom: 0;
            margin-top: 0;
        }

        .header h1 {
            font-family: 'Poppins', sans-serif;
            font-size: clamp(1.5rem, 3vw, 2.5rem);
            font-weight: 600;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            text-transform: uppercase;
            margin-top: 0;
        }

        /* ========================================================== */
        /* BENUTZER-ID UND STATUS                                   */
        /* ========================================================== */
        .status-bar {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.8rem;
            text-align: center;
            margin-top: 5px;
            margin-bottom: 10px;
            opacity: 0.7;
            word-break: break-all;
        }
        .status-bar .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .status-bar.loading .status-indicator { background-color: var(--color-warning); }
        .status-bar.ready .status-indicator { background-color: var(--color-ok); }
        .status-bar.error .status-indicator { background-color: var(--color-critical); }
        
        /* ========================================================== */
        /* BURGER-MENÜ                                              */
        /* ========================================================== */
        .burger-menu-container {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1000;
        }

        .burger-menu-icon {
            width: 30px;
            height: 25px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            cursor: pointer;
        }

        .burger-menu-icon span {
            display: block;
            width: 100%;
            height: 3px;
            background-color: var(--text-color);
            border-radius: 5px;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .burger-menu-icon.open span:nth-child(1) {
            transform: translateY(11px) rotate(45deg);
        }

        .burger-menu-icon.open span:nth-child(2) {
            opacity: 0;
        }

        .burger-menu-icon.open span:nth-child(3) {
            transform: translateY(-11px) rotate(-45deg);
        }

        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease, visibility 0.5s ease;
            z-index: 999;
        }

        .menu-overlay.open {
            opacity: 1;
            visibility: visible;
        }

        .menu-content {
            position: absolute;
            top: 70px;
            left: 20px;
            background: var(--glass-bg);
            border-radius: 16px;
            border: 1px solid var(--glass-border);
            padding: 30px;
            text-align: center;
        }

        .menu-content h2 {
            font-family: 'Share Tech Mono', monospace;
            text-transform: uppercase;
        }

        .menu-option {
            font-family: 'Poppins', sans-serif;
            font-size: 1.2rem;
            padding: 10px 20px;
            margin: 10px 0;
            background: var(--glass-bg);
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.3s ease;
            text-decoration: none;
            color: var(--text-color);
            display: block;
            border: 1px solid var(--glass-border);
        }

        .menu-option:hover {
            background: rgba(255, 255, 255, 0.2);
            box-shadow: var(--glass-shadow);
        }

        .menu-option.active {
            border: 2px solid var(--accent-color);
            box-shadow: 0 0 10px var(--accent-color);
        }

        /* ========================================================== */
        /* KACHEL-RASTER UND ANDERE ELEMENTE                        */
        /* ========================================================== */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            max-width: 600px;
            width: 100%;
            margin-bottom: 0;
        }

        @media (min-width: 768px) {
            .grid-container {
                grid-template-columns: repeat(6, 1fr);
                gap: 20px;
            }
        }

        @media (min-width: 1024px) {
            .grid-container {
                max-width: 900px;
            }
        }

        .tile {
            position: relative;
            background: var(--glass-bg);
            border-radius: 16px;
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: var(--glass-shadow);
            aspect-ratio: 1 / 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            text-decoration: none;
            color: var(--text-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            padding: 10px;
        }

        .tile:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 0 15px var(--accent-color), 0 0 25px var(--accent-color);
        }

        .tile.editing {
            border: 2px solid var(--color-warning);
            transform: none;
        }
        
        .tile.empty {
            border: 2px dashed rgba(255, 255, 255, 0.3);
            cursor: default;
        }

        .tile .icon {
            font-size: clamp(1.5rem, 3vw, 2.5rem);
            margin-bottom: 5px;
            line-height: 1;
        }

        .tile .text {
            font-family: 'Share Tech Mono', monospace;
            font-size: clamp(0.7rem, 2vw, 1rem);
            font-weight: 400;
            line-height: 1.2;
            text-transform: uppercase;
        }
        
        .loading-text {
            font-family: 'Share Tech Mono', monospace;
            font-size: clamp(1rem, 2vw, 1.5rem);
            opacity: 0.8;
            text-align: center;
            margin-top: 50px;
        }

        .search-container {
            width: 100%;
            max-width: 500px;
            display: flex;
            justify-content: center;
            margin-top: 25px;
            margin-bottom: 10px;
        }

        .search-box {
            background: var(--glass-bg);
            border-radius: 16px;
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: var(--glass-shadow);
            display: flex;
            overflow: hidden;
            width: 100%;
        }

        .search-input {
            flex-grow: 1;
            padding: 12px 20px;
            font-size: 1rem;
            border: none;
            background: transparent;
            color: var(--text-color);
            outline: none;
            font-family: 'Poppins', sans-serif;
        }

        .search-input::placeholder {
            color: rgba(240, 240, 240, 0.7);
        }

        .search-button {
            padding: 12px 25px;
            font-size: 1rem;
            border: none;
            background: var(--accent-color);
            color: var(--dark-bg);
            cursor: pointer;
            transition: background 0.3s ease;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
        }

        .search-button:hover {
            background: #ffcc66;
            filter: brightness(1.2);
        }

        body.green-accent-mode .search-button:hover,
        body.blue-neon-mode .search-button:hover,
        body.solarized-light-mode .search-button:hover {
            filter: brightness(1.2);
        }

        .nixie-clock {
            font-family: 'Share Tech Mono', monospace;
            font-size: clamp(1.5rem, 4vw, 3rem);
            text-shadow: 0 0 10px var(--accent-color), 0 0 20px var(--accent-color), 0 0 30px var(--accent-color);
            color: var(--accent-color);
            letter-spacing: 2px;
            line-height: 1.2;
            text-align: center;
            margin-top: 20px;
        }

        .nixie-clock .date {
            font-size: clamp(1rem, 2vw, 1.5rem);
            opacity: 0.8;
            margin-top: 5px;
        }

        /* Responsive 3D-Animation */
        .tech-animation-container {
            width: clamp(100px, 20vw, 200px);
            aspect-ratio: 1 / 1;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: -15px;
        }

        .tech-animation-container:hover {
            transform: scale(1.05);
        }

        /* Container für die neue Formänderungsbox */
        .change-shape-container, .edit-mode-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: var(--glass-bg);
            border-radius: 16px;
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: var(--glass-shadow);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            cursor: pointer;
            padding: 5px;
            text-decoration: none;
            color: var(--text-color);
            transition: transform 0.3s ease;
        }

        .change-shape-container:hover, .edit-mode-container:hover {
            transform: scale(1.1);
        }
        
        .change-shape-container {
            bottom: 80px;
        }

        .change-shape-container .icon, .edit-mode-container .icon {
            font-size: 1.5rem;
            line-height: 1;
        }

        .change-shape-container .text, .edit-mode-container .text {
            display: none;
        }

        /* Modales Dialogfeld */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal.visible {
            visibility: visible;
            opacity: 1;
        }

        .modal-content {
            background: var(--glass-bg);
            border-radius: 16px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            padding: 20px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        .modal.visible .modal-content {
            transform: scale(1);
        }

        .modal-content h3 {
            font-family: 'Share Tech Mono', monospace;
            text-transform: uppercase;
            margin-top: 0;
        }
        .modal-content input {
            width: calc(100% - 20px);
            padding: 10px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: var(--text-color);
            outline: none;
        }
        .modal-content input:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 5px var(--accent-color);
        }
        .modal-buttons {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }
        .modal-buttons button {
            flex: 1;
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .modal-buttons .save-button {
            background: var(--color-ok);
            color: var(--dark-bg);
        }
        .modal-buttons .delete-button {
            background: var(--color-critical);
            color: var(--dark-bg);
        }
        .modal-buttons .cancel-button {
            background: var(--color-info);
            color: var(--dark-bg);
        }
        .modal-buttons button:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <!-- Burger-Menü-Icon -->
    <div class="burger-menu-container">
        <div class="burger-menu-icon" id="burger-menu-icon">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </div>

    <!-- Menü-Overlay -->
    <div class="menu-overlay" id="menu-overlay">
        <div class="menu-content">
            <h2>Design wählen</h2>
            <a href="#" class="menu-option" data-theme="dark-mode">Dunkler Modus</a>
            <a href="#" class="menu-option" data-theme="light-mode">Heller Modus</a>
            <a href="#" class="menu-option" data-theme="green-accent-mode">Grün-Akzent</a>
            <a href="#" class="menu-option" data-theme="blue-neon-mode">Blau-Neon</a>
            <a href="#" class="menu-option" data-theme="solarized-light-mode">Solarisiert</a>
        </div>
    </div>

    <!-- Technische Animation -->
    <div class="tech-animation-container" id="tech-animation-container">
        <canvas id="animation-canvas"></canvas>
    </div>

    <!-- Hauptüberschrift (jetzt wieder dynamisch) -->
    <header class="header">
        <h1 id="greeting-title"></h1>
    </header>

    <div class="status-bar" id="status-bar">
        <span class="status-indicator" id="status-indicator"></span>
        <span id="user-id-display"></span>
    </div>

    <!-- Kacheln werden dynamisch von JavaScript hinzugefügt -->
    <main class="grid-container" id="grid-container"></main>

    <!-- Suchfeld -->
    <div class="search-container">
        <div class="search-box">
            <input type="text" id="search-input" class="search-input" placeholder="In Google suchen">
            <button id="search-button" class="search-button">Suchen</button>
        </div>
    </div>

    <!-- Uhr -->
    <div class="nixie-clock" id="nixie-clock">
        <div id="time"></div>
        <div class="date" id="date"></div>
    </div>

    <!-- Buttons für Animation und Bearbeitungsmodus -->
    <a href="#" id="change-shape-tile" class="change-shape-container">
        <div class="icon">🔄</div>
        <div class="text">ANIMATION ÄNDERN</div>
    </a>
    <a href="#" id="edit-mode-tile" class="edit-mode-container" style="bottom: 20px;">
        <div class="icon">✏️</div>
        <div class="text">LINKS BEARBEITEN</div>
    </a>

    <!-- Modales Dialogfeld für die Link-Bearbeitung -->
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <h3 id="modal-title">Link bearbeiten</h3>
            <!-- NEUES EINGABEFELD FÜR DAS ICON -->
            <input type="text" id="link-icon-input" placeholder="Icon/Emoji (z.B. 🌐, 📧, 💡)">
            <input type="text" id="link-name-input" placeholder="Link-Name">
            <input type="url" id="link-url-input" placeholder="URL">
            <div class="modal-buttons">
                <button class="save-button" id="modal-save">Speichern</button>
                <button class="delete-button" id="modal-delete">Löschen</button>
                <button class="cancel-button" id="modal-cancel">Abbrechen</button>
            </div>
        </div>
    </div>

    <!-- Three.js Bibliothek -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        setLogLevel('debug');

        // --- Firebase Globale Variablen ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // --- App-Variablen ---
        let links = [];
        let isEditMode = false;
        let db;
        let auth;
        let userId;
        let isAuthReady = false;
        let unsubscribeFromLinks;
        let currentEditingLink = null;

        // --- DOM-Elemente ---
        const gridContainer = document.getElementById('grid-container');
        const editModeTile = document.getElementById('edit-mode-tile');
        const editModal = document.getElementById('edit-modal');
        const modalTitle = document.getElementById('modal-title');
        const linkIconInput = document.getElementById('link-icon-input');
        const linkNameInput = document.getElementById('link-name-input');
        const linkUrlInput = document.getElementById('link-url-input');
        const modalSaveBtn = document.getElementById('modal-save');
        const modalDeleteBtn = document.getElementById('modal-delete');
        const modalCancelBtn = document.getElementById('modal-cancel');
        const userIdDisplay = document.getElementById('user-id-display');
        const statusBar = document.getElementById('status-bar');

        // Standard-Links
        const defaultLinks = [
            { icon: '📧', text: 'ICLOUD MAIL', url: 'https://www.icloud.com/mail/' },
            { icon: '📨', text: 'GMAIL', url: 'https://mail.google.com/mail/u/0/#inbox' },
            { icon: '🏢', text: 'INTRANET', url: 'https://eckdde.sharepoint.com/sites/Startseite-Intranet' },
            { icon: '📖', text: 'WIKI', url: 'https://wiki.eckd.inhouse.eckd.de/wiki/IT-Systeme_nach_Kunde' },
            { icon: '👔', text: 'HRWORKS', url: 'https://login.hrworks.de/?companyId=eckd&directssologin=true' },
            { icon: '⛪', text: 'KIRIS', url: 'https://apps.churchx.de/itm-kiris-eckd-prod' },
            { icon: '🤖', text: 'CHATGPT', url: 'https://chat.openai.com/' },
            { icon: '✨', text: 'GEMINI', url: 'https://gemini.google.com/?hl=de' },
            { icon: '💼', text: 'COPILOT', url: 'https://m365.cloud.microsoft:443/chat/?titleId=T_82714181-8fcd-715b-fe7b-98ba417f56d0&source=embedded-builder' },
            { icon: '📰', text: 'GOOGLE NEWS', url: 'https://news.google.com/' },
            { icon: '☁️', text: 'EKKW-CLOUD', url: 'https://ekkw.cloud.com' },
            { icon: '📰', text: 'BILD', url: 'https://www.bild.de/' },
        ];

        // --- Firebase Setup ---
        async function setupFirebase() {
            try {
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                statusBar.classList.add('loading');
                userIdDisplay.textContent = 'Verbinde mit der Cloud...';

                await new Promise((resolve, reject) => {
                    const unsubscribe = onAuthStateChanged(auth, async (user) => {
                        unsubscribe();
                        if (user) {
                            userId = user.uid;
                        } else {
                            if (initialAuthToken) {
                                await signInWithCustomToken(auth, initialAuthToken);
                            } else {
                                await signInAnonymously(auth);
                            }
                            userId = auth.currentUser.uid;
                        }
                        isAuthReady = true;
                        resolve();
                    }, (error) => {
                        console.error('Authentifizierungsfehler:', error);
                        statusBar.classList.remove('loading');
                        statusBar.classList.add('error');
                        userIdDisplay.textContent = 'Fehler bei der Anmeldung.';
                        reject(error);
                    });
                });

                userIdDisplay.textContent = `Verbunden als: ${userId}`;
                statusBar.classList.remove('loading');
                statusBar.classList.add('ready');

                startLinksSync();

            } catch (error) {
                console.error("Fehler beim Initialisieren von Firebase:", error);
                statusBar.classList.remove('loading');
                statusBar.classList.add('error');
                userIdDisplay.textContent = 'Verbindungsfehler zur Cloud.';
            }
        }

        // --- Links synchronisieren ---
        function startLinksSync() {
            if (unsubscribeFromLinks) {
                unsubscribeFromLinks();
            }
            const userLinksDocRef = doc(db, `artifacts/${appId}/users/${userId}/dashboard/links_doc`);
            
            unsubscribeFromLinks = onSnapshot(userLinksDocRef, async (docSnap) => {
                if (docSnap.exists() && docSnap.data().links) {
                    // Daten aus der Cloud laden
                    links = docSnap.data().links;
                } else {
                    // Wenn keine Daten vorhanden, Standard-Links in die Datenbank schreiben
                    const docExists = (await getDoc(userLinksDocRef)).exists();
                    if (!docExists) {
                         await saveLinks(defaultLinks);
                         links = defaultLinks;
                    }
                }
                renderLinks();
            }, (error) => {
                console.error("Fehler beim Abrufen der Links:", error);
                statusBar.classList.remove('ready');
                statusBar.classList.add('error');
                userIdDisplay.textContent = 'Fehler beim Synchronisieren der Daten.';
            });
        }

        // --- Links in der Datenbank speichern ---
        async function saveLinks(newLinks) {
            if (!isAuthReady || !userId) {
                console.error("Firebase nicht bereit oder Benutzer-ID fehlt.");
                return;
            }
            const userLinksDocRef = doc(db, `artifacts/${appId}/users/${userId}/dashboard/links_doc`);
            try {
                await setDoc(userLinksDocRef, { links: newLinks });
                console.log("Links erfolgreich gespeichert.");
            } catch (e) {
                console.error("Fehler beim Speichern der Links:", e);
                // Hier könntest du eine Fehlermeldung in der UI anzeigen
            }
        }

        // --- Links dynamisch rendern ---
        function renderLinks() {
            gridContainer.innerHTML = '';
            
            if (links.length === 0 && !isEditMode) {
                 gridContainer.innerHTML = '<div class="loading-text">Noch keine Links vorhanden. Starte den Bearbeitungsmodus, um welche hinzuzufügen.</div>';
                 return;
            }

            links.forEach((link, index) => {
                const tile = document.createElement('a');
                tile.className = 'tile';
                if (isEditMode) {
                    tile.href = '#';
                    tile.classList.add('editing');
                    tile.addEventListener('click', (e) => {
                        e.preventDefault();
                        showEditModal(link, index);
                    });
                } else {
                    tile.href = link.url;
                    tile.target = '_blank';
                }

                const iconDiv = document.createElement('div');
                iconDiv.className = 'icon';
                iconDiv.textContent = link.icon;
                tile.appendChild(iconDiv);

                const textDiv = document.createElement('div');
                textDiv.className = 'text';
                textDiv.textContent = link.text;
                tile.appendChild(textDiv);

                gridContainer.appendChild(tile);
            });

            if (isEditMode) {
                const addTile = document.createElement('a');
                addTile.className = 'tile';
                addTile.href = '#';
                addTile.classList.add('editing');
                addTile.addEventListener('click', (e) => {
                    e.preventDefault();
                    showEditModal(null);
                });
                const iconDiv = document.createElement('div');
                iconDiv.className = 'icon';
                iconDiv.textContent = '➕';
                addTile.appendChild(iconDiv);
                const textDiv = document.createElement('div');
                textDiv.className = 'text';
                textDiv.textContent = 'LINK HINZUFÜGEN';
                addTile.appendChild(textDiv);
                gridContainer.appendChild(addTile);
            }
        }

        // --- Bearbeitungsmodus ---
        function toggleEditMode() {
            isEditMode = !isEditMode;
            editModeTile.style.backgroundColor = isEditMode ? 'var(--color-warning)' : '';
            editModeTile.style.borderColor = isEditMode ? 'var(--color-warning)' : 'var(--glass-border)';
            renderLinks();
        }

        editModeTile.addEventListener('click', (e) => {
            e.preventDefault();
            toggleEditMode();
        });

        // --- Modales Dialogfeld ---
        function showEditModal(link, index) {
            currentEditingLink = link ? { ...link, index } : null;
            modalTitle.textContent = link ? 'Link bearbeiten' : 'Link hinzufügen';
            linkIconInput.value = link ? link.icon : '🌐';
            linkNameInput.value = link ? link.text : '';
            linkUrlInput.value = link ? link.url : '';
            modalDeleteBtn.style.display = link ? 'block' : 'none';
            editModal.classList.add('visible');
        }

        function hideEditModal() {
            editModal.classList.remove('visible');
        }

        modalSaveBtn.addEventListener('click', () => {
            const icon = linkIconInput.value.trim() || '🌐';
            const name = linkNameInput.value.trim().toUpperCase();
            const url = linkUrlInput.value.trim();
            if (name && url) {
                const newLinks = [...links];
                if (currentEditingLink) {
                    newLinks[currentEditingLink.index].icon = icon;
                    newLinks[currentEditingLink.index].text = name;
                    newLinks[currentEditingLink.index].url = url;
                } else {
                    newLinks.push({ icon, text: name, url });
                }
                saveLinks(newLinks);
                hideEditModal();
            }
        });

        modalDeleteBtn.addEventListener('click', () => {
            if (currentEditingLink) {
                const newLinks = [...links];
                newLinks.splice(currentEditingLink.index, 1);
                saveLinks(newLinks);
                hideEditModal();
            }
        });

        modalCancelBtn.addEventListener('click', hideEditModal);

        // --- Zusätzliche Funktionen ---
        function updateGreeting() {
            const now = new Date();
            const hour = now.getHours();
            let dynamicPart;

            if (hour >= 5 && hour < 10) {
                dynamicPart = 'MORGEN';
            } else if (hour >= 10 && hour < 19) {
                dynamicPart = 'TAG';
            } else {
                dynamicPart = 'ABEND';
            }
            document.getElementById('greeting-title').textContent = `HALLO HEIKO, ICH WÜNSCHE DIR EINEN SCHÖNEN ${dynamicPart}`.toUpperCase();
        }

        function updateClock() {
            const now = new Date();
            const time = now.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            const date = now.toLocaleDateString('de-DE', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            document.getElementById('time').textContent = time;
            document.getElementById('date').textContent = date;
        }

        setInterval(updateClock, 1000);
        updateClock();
        updateGreeting();

        document.getElementById('search-button').addEventListener('click', () => {
            const input = document.getElementById('search-input');
            const query = input.value;
            if (query) {
                window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}`, '_blank');
                input.value = '';
            }
        });

        document.getElementById('search-input').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                document.getElementById('search-button').click();
            }
        });

        const burgerIcon = document.getElementById('burger-menu-icon');
        const menuOverlay = document.getElementById('menu-overlay');
        const menuOptions = document.querySelectorAll('.menu-option');

        function toggleMenu() {
            burgerIcon.classList.toggle('open');
            menuOverlay.classList.toggle('open');
        }

        function applyTheme(theme) {
            document.body.classList.remove('dark-mode', 'light-mode', 'green-accent-mode', 'blue-neon-mode', 'solarized-light-mode');
            if (theme !== 'dark-mode') {
                document.body.classList.add(theme);
            }
            localStorage.setItem('theme', theme);
            updateAnimationColor();
            menuOptions.forEach(option => {
                option.classList.remove('active');
                if (option.dataset.theme === theme) {
                    option.classList.add('active');
                }
            });
        }

        burgerIcon.addEventListener('click', toggleMenu);
        menuOverlay.addEventListener('click', (e) => {
            if (e.target.classList.contains('menu-overlay')) {
                toggleMenu();
            }
        });

        menuOptions.forEach(option => {
            option.addEventListener('click', (e) => {
                e.preventDefault();
                const selectedTheme = e.target.dataset.theme;
                applyTheme(selectedTheme);
                toggleMenu();
            });
        });

        const savedTheme = localStorage.getItem('theme') || 'dark-mode';

        // --- 3D-Animation ---
        let scene, camera, renderer, mesh;
        let isFastSpinning = false;
        let currentGeometryIndex = 0;
        const geometries = [
            new THREE.IcosahedronGeometry(1.5, 0),
            new THREE.BoxGeometry(2, 2, 2),
            new THREE.TorusGeometry(1.5, 0.5, 16, 100),
            new THREE.SphereGeometry(1.5, 32, 32),
            new THREE.ConeGeometry(1.5, 3, 32)
        ];

        function updateAnimationColor() {
            if (mesh) {
                const accentColor = getComputedStyle(document.body).getPropertyValue('--accent-color').trim();
                const colorHex = new THREE.Color(accentColor);
                mesh.material.color.set(colorHex);
                mesh.material.emissive.set(colorHex);
            }
        }

        function initAnimation() {
            const container = document.getElementById('tech-animation-container');
            const canvas = document.getElementById('animation-canvas');

            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true, alpha: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);

            try {
                const savedIndex = localStorage.getItem('animationShapeIndex');
                if (savedIndex !== null) {
                    currentGeometryIndex = parseInt(savedIndex, 10);
                }
            } catch (e) {
                console.error("Fehler beim Laden der Animationsform aus localStorage:", e);
            }

            const material = new THREE.MeshStandardMaterial({
                color: 0xffffff,
                emissive: 0x00ffff,
                roughness: 0.5,
                metalness: 0.5,
                flatShading: true
            });
            material.emissiveIntensity = 0.5;
            mesh = new THREE.Mesh(geometries[currentGeometryIndex], material);
            scene.add(mesh);
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            const pointLight = new THREE.PointLight(0xffffff, 1);
            pointLight.position.set(5, 5, 5);
            scene.add(pointLight);
            camera.position.z = 4;
            window.addEventListener('resize', onWindowResize, false);
            function onWindowResize() {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            }
            onWindowResize();
            updateAnimationColor();
        }

        function animate() {
            requestAnimationFrame(animate);
            if (mesh) {
                const rotationSpeed = isFastSpinning ? 0.05 : 0.005;
                mesh.rotation.x += rotationSpeed;
                mesh.rotation.y += rotationSpeed;
            }
            renderer.render(scene, camera);
        }

        function changeAnimationShape() {
            scene.remove(mesh);
            currentGeometryIndex = (currentGeometryIndex + 1) % geometries.length;
            try {
                localStorage.setItem('animationShapeIndex', currentGeometryIndex);
            } catch (e) {
                console.error("Fehler beim Speichern der Animationsform in localStorage:", e);
            }
            mesh = new THREE.Mesh(geometries[currentGeometryIndex], mesh.material);
            scene.add(mesh);
            updateAnimationColor();
        }

        window.onload = function() {
            setupFirebase();
            initAnimation();
            animate();
            applyTheme(savedTheme);
        };

        const techAnimationContainer = document.getElementById('tech-animation-container');
        techAnimationContainer.addEventListener('click', () => {
            isFastSpinning = !isFastSpinning;
        });

        document.getElementById('change-shape-tile').addEventListener('click', (e) => {
            e.preventDefault();
            changeAnimationShape();
        });
    </script>
</body>
</html>
